<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NexWeba ‚Äì Stage 10</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body>

<h2>NexWeba ‚Äì Stage 10</h2>
<p>This processes a Pi Testnet transaction to meet Stage 10 requirements.</p>

<button id="stage10-btn">Process Testnet Transaction</button>
<p id="status"></p>

<script>
  Pi.init({ version: "2.0", sandbox: true });

  const status = document.getElementById("status");

  async function processTransaction() {
    status.textContent = "‚è≥ Processing...";

    try {
      await Pi.authenticate(["payments"], () => {});

      await Pi.createPayment(
        {
          amount: 0.01,
          memo: "NexWeba Stage 10",
          metadata: { app: "NexWeba", stage: 10 }
        },
        {
          onReadyForServerApproval: async (paymentId) => {
            status.textContent = "üîÑ Approving on server...";

            await fetch("https://YOUR_SERVER_URL/approve", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ paymentId })
            });
          },

          onReadyForServerCompletion: async (paymentId, txid) => {
            await fetch("https://YOUR_SERVER_URL/complete", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ paymentId, txid })
            });

            status.textContent = "‚úÖ Stage 10 completed successfully.";
          },

          onCancel: () => {
            status.textContent = "‚ùå Transaction cancelled.";
          },

          onError: (error) => {
            console.error(error);
            status.textContent = "‚ùå Transaction error.";
          }
        }
      );

    } catch (err) {
      console.error(err);
      status.textContent = "‚ùå Authentication or SDK error.";
    }
  }

  document.getElementById("stage10-btn")
    .addEventListener("click", processTransaction);
</script>

</body>
</html>
