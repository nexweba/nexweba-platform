<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NexWeba – Stage 10</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Pi SDK -->
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
  <script>
    Pi.init({ version: "2.0", sandbox: true });
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9fafb;
      text-align: center;
      padding: 40px;
    }
    button {
      padding: 14px 24px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>

<body>

<h2>NexWeba – Stage 10</h2>
<p>This processes a Pi Testnet transaction to meet Stage 10 requirements.</p>

<button onclick="processStage10()">Process Testnet Transaction</button>

<p id="status"></p>

<script>
async function processStage10() {
  const status = document.getElementById("status");

  try {
    // 1️⃣ Authenticate user
    const auth = await Pi.authenticate(
      ["username"],
      onIncompletePayment
    );

    // 2️⃣ Create Testnet payment
    const payment = await Pi.createPayment({
      amount: 0.01,
      memo: "NexWeba Stage 10 Test",
      metadata: { purpose: "stage10" }
    }, {
      onReadyForServerApproval: function(paymentId) {
        console.log("Ready for approval:", paymentId);
      },
      onReadyForServerCompletion: function(paymentId, txid) {
        console.log("Completed:", paymentId, txid);
        status.textContent = "✅ Testnet transaction completed successfully.";
      },
      onCancel: function(paymentId) {
        status.textContent = "❌ Transaction cancelled.";
      },
      onError: function(error) {
        console.error(error);
        status.textContent = "❌ Transaction failed.";
      }
    });

  } catch (err) {
    console.error(err);
    status.textContent = "❌ Authentication or SDK error.";
  }
}

function onIncompletePayment(payment) {
  console.log("Incomplete payment found:", payment);
}
</script>

</body>
</html>
