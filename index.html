<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NexWeba – Stage 10</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body>

<h2>NexWeba – Stage 10</h2>
<p>This processes a Pi Testnet transaction to meet Stage 10 requirements.</p>

<button id="stage10-btn">Process Testnet Transaction</button>
<p id="status"></p>

<script>
  Pi.init({ version: "2.0", sandbox: true });

  async function processTransaction() {
    const status = document.getElementById("status");
    status.textContent = "⏳ Processing...";

    try {
      // 1. Authenticate user
      const auth = await Pi.authenticate(
        ["payments"],
        function onIncompletePayment(payment) {
          console.log("Incomplete payment", payment);
        }
      );

      // 2. Create Testnet transaction
      const payment = await Pi.createPayment({
        amount: 0.01,
        memo: "NexWeba Stage 10 Test",
        metadata: { purpose: "stage10" }
      }, {
        onReadyForServerApproval(paymentId) {
          console.log("Ready for approval:", paymentId);
        },
        onReadyForServerCompletion(paymentId, txid) {
          console.log("Completed:", paymentId, txid);
        },
        onCancel(paymentId) {
          status.textContent = "❌ Transaction cancelled by user.";
        },
        onError(error, payment) {
          console.error(error);
          status.textContent = "❌ Transaction error.";
        }
      });

      status.textContent = "✅ Testnet transaction successful. Stage 10 completed.";

    } catch (err) {
      console.error(err);
      status.textContent = "❌ Authentication or SDK error.";
    }
  }

  document
    .getElementById("stage10-btn")
    .addEventListener("click", processTransaction);
</script>

</body>
</html>
